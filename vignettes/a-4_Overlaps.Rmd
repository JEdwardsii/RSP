---
title: 4. Calculating overlaps
subtitle: "Refining the Shortest Paths (RSP) of animals tracked with acoustic transmitters in estuarine regions"
author: "Yuri Niella & Hugo FlÃ¡vio"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{4. Calculating overlaps}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
	echo = TRUE)
```

## Index

1. [Preparing the data](a-1_Preparing_the_data.html)
2. [Refining the Shortest Paths in-water](a-2_Refining_Shortest_paths.html)
3. [Calculating utilization distribution](a-3_dBBMM.html)
4. [Calculating overlaps](a-4_Overlaps.html)

***

If your study comprises **multiple biological groups** (e.g. different species, different sexes, etc.), you might find useful to calculate the ammounts of **overlap** between them. For calculating the overlaps, the areas of space use must be first calculated at **group** level (using the `getAreas()` function). Overlaps are automatically calculated at the same levels provided in the `breaks` argument in `getAreas()`, therefore, are returned at the 50% and 95% contours by default. Areas of overlap correspond to the ammount from the smallest area that falls within the largest area, calculated for all monitored groups and returned both in absolute (squared meters) and percentages. 

### 4.1. Calculating overlaps for group dBBMM 

When utilization distribution areas are calculated for **group dBBMM**, models are calculated at the track level. Since this analysis does not provide standardized tracks (i.e. start and end times might vary among tracked individuals), this option simply calculates the overall overlap among the groups of interest. 

```
overlap.save <- geOverlaps(areas.group)
overlap.save$areas$`0.95`$absolute
```

|          | R64K-4075 | R64K-4125| R64K-4128| R64K-4138|
|:---------|----------:|---------:|---------:|---------:|
| R64K-4075|         NA|  82080502|  31831020| 103273976|
| R64K-4125|   82080502|        NA|  33164114| 186469924|
| R64K-4128|   31831020|  33164114|        NA|  44753870|
| R64K-4138|  103273976| 186469924|  44753870|        NA|

```
overlap.save$areas$`0.95`$percentage
```

|          | R64K-4075 | R64K-4125| R64K-4128| R64K-4138|
|:---------|----------:|---------:|---------:|---------:|
| R64K-4075|         NA| 0.7607161| 0.7090909| 0.9571357|
| R64K-4125|  0.7607161|        NA| 0.7387879| 0.9081876|
| R64K-4128|  0.7090909| 0.7387879|        NA| 0.9969697|
| R64K-4138|  0.9571357| 0.9081876| 0.9969697|        NA|

Now we can use `plotOverlaps()` to see exactly where in the study area the overlap took place:

```
plotOverlaps(overlaps = over.save, areas = areas.save, base.raster = limfjord.shape, 
	groups = c("R64K-4075", "R64K-4125"), level = 0.95) 
plotOverlaps(overlaps = over.save, areas = areas.save, base.raster = limfjord.shape, 
	groups = c("R64K-4075", "R64K-4128"), level = 0.95)
```
![](plotOverlaps1.png){#id .class width=80%} 


### 4.2. Calculating overlaps for timeslot dBBMM 

The standardized tracks returned from **timeslot dBBMM** can be used to calculate overlaps between multiple groups both in **space** and **time**. 

```
overlap.save <- geOverlaps(areas.group)
overlap.save$areas$`0.95`$absolutes$`128`
```
|         |      Bream|  Tarwhine|
|:--------|----------:|---------:|
|   Bream |         NA|   2454723|
| Tarwhine|    2454723|        NA|

```
overlap.save$areas$`0.95`$percentage$`128`
```

|         |      Bream|  Tarwhine|
|:--------|----------:|---------:|
|   Bream |         NA| 0.9680747|
| Tarwhine|  0.9680747|        NA|


```
plotOverlaps(overlaps = overlap.save, areas = areas.group, base.raster = macquarie.shape, 
  groups = c("Bream", "Tarwhine"), timeslot = 127, level = 0.95, title = "timeslot 127") 

M: No overlap found between 'Bream' and 'Tarwhine'. Plotting only the separate areas.

plotOverlaps(overlaps = overlap.save, areas = areas.group, base.raster = macquarie.shape, 
  groups = c("Bream", "Tarwhine"), timeslot = 128, level = 0.95, title = "timeslot 128") 
```
![Please note the message for the first plot: no overlaps were found between the two groups during timeslot 126.](plotOverlaps2.png){#id .class width=100%} 


